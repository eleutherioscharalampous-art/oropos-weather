<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ğŸŒ¦ï¸ 15Î®Î¼ÎµÏÎ· Î ÏÏŒÎ³Î½Ï‰ÏƒÎ· â€“ Î”Î®Î¼Î¿Ï‚ Î©ÏÏ‰Ï€Î¿Ï (V15)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, Arial, sans-serif;
            background: radial-gradient(circle at top, #193a63 0%, #050915 55%, #02030a 100%);
            color: #fff;
            padding: 16px;
            line-height: 1.5;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: rgba(255,255,255,0.04);
            border-radius: 20px;
            padding: 18px;
            box-shadow: 0 18px 40px rgba(0,0,0,0.55);
        }
        h1 {
            font-size: 24px;
            text-align: center;
            margin-bottom: 4px;
        }
        .subtitle {
            text-align: center;
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        .status {
            margin-bottom: 12px;
            padding: 9px 10px;
            border-radius: 12px;
            background: rgba(0,0,0,0.35);
            border-left: 4px solid #5aff8d;
            font-size: 12px;
        }
        .status.danger {
            border-left-color: #ff6b81;
            background: linear-gradient(90deg, rgba(255,71,87,0.27), rgba(255,130,140,0.16));
        }
        .section-title {
            font-size: 15px;
            margin-top: 10px;
            margin-bottom: 6px;
            font-weight: 700;
        }
        .location-selector {
            background: rgba(0,0,0,0.4);
            padding: 12px;
            border-radius: 16px;
            margin-bottom: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        .location-label {
            font-size: 13px;
            font-weight: 600;
        }
        .location-select {
            flex: 1;
            min-width: 200px;
            padding: 6px 10px;
            border-radius: 16px;
            border: none;
            font-size: 13px;
        }
        .grid {
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 14px;
        }
        iframe {
            width: 100%;
            border-radius: 12px;
            border: none;
            min-height: 380px;
            background: #000;
        }
        .analysis-box {
            background: rgba(0,0,0,0.3);
            border-radius: 14px;
            padding: 10px;
            font-size: 12px;
        }
        .analysis-inner {
            background: #050a14;
            border-radius: 10px;
            padding: 9px;
            border-left: 3px solid #00d4ff;
            max-height: 380px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .combo-chart-section {
            margin-top: 14px;
            background: rgba(0,0,0,0.3);
            border-radius: 14px;
            padding: 16px;
        }
        canvas {
            max-height: 320px;
            margin-bottom: 8px;
        }
        .days-grid {
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px,1fr));
            gap: 8px;
        }
        .day-card {
            background: rgba(10,17,30,0.96);
            border-radius: 12px;
            padding: 8px;
            font-size: 12px;
            border: 2px solid rgba(255,255,255,0.08);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            margin-bottom: 2px;
        }
        .day-date { font-size: 12px; }
        .day-emoji { font-size: 22px; }
        .metric-row { font-size: 11px; }
        .legend {
            margin-top: 8px; display: flex;
            flex-wrap: wrap; gap: 8px; font-size: 11px;
        }
        .legend-item {
            display: inline-flex; align-items: center;
            gap: 4px; padding: 4px 6px;
            border-radius: 999px; background: rgba(0,0,0,0.35);
        }
        .share-box {
            margin-top: 10px;
            display: flex; flex-wrap: wrap;
            gap: 8px; align-items: center;
        }
        .btn {
            padding: 8px 14px;
            border-radius: 18px;
            border: none;
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-primary { background: #00d4ff; color: #011019; }
        .btn-secondary { background: #ff6b81; color: #fff; }
        .btn-small {
            padding: 4px 10px;
            font-size: 11px;
            border-radius: 14px;
            margin-bottom: 6px;
        }
        .small {
            font-size: 11px;
            opacity: 0.8;
        }
        .footer {
            margin-top: 14px;
            text-align: center;
            font-size: 11px;
            opacity: 0.75;
        }
        @media (max-width: 780px) {
            .grid { grid-template-columns: 1fr; }
            iframe { min-height: 330px; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸŒ¦ï¸ 15Î®Î¼ÎµÏÎ· Î ÏÏŒÎ³Î½Ï‰ÏƒÎ· â€“ Î”Î®Î¼Î¿Ï‚ Î©ÏÏ‰Ï€Î¿Ï (V15)</h1>
    <div class="subtitle">
        Î•Ï€Î¹Î»Î¿Î³Î® Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ (Î‘Ï„Ï„Î¹ÎºÎ® & Î•ÏÎ²Î¿Î¹Î±). Î‘Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ + ÏƒÏ…Î½Î´Ï…Î±ÏƒÏ„Î¹ÎºÏŒ Î³ÏÎ¬Ï†Î·Î¼Î±.
    </div>

    <!-- ğŸ—ºï¸ LOCATION SELECTOR -->
    <div class="location-selector">
        <span class="location-label">ğŸ“ Î ÎµÏÎ¹Î¿Ï‡Î®:</span>
        <select id="areaSelect" class="location-select">
            <!-- Options Î¸Î± Î³ÎµÎ¼Î¯ÏƒÎ¿Ï…Î½ Î±Ï€ÏŒ JS -->
        </select>
        <span style="margin-left:auto;font-size:12px;opacity:0.8;">ğŸ”„ <span id="lastUpdate">-</span></span>
    </div>

    <div id="statusBar" class="status">
        âœ… Î”ÎµÎ½ Î­Ï‡Î¿Ï…Î½ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÏ„ÎµÎ¯ Ï€Î¿Î»Ï Î­Î½Ï„Î¿Î½Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î± (ÎºÏŒÎºÎºÎ¹Î½Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿) ÏƒÏ„Î¹Ï‚ ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ ÏÏÎµÏ‚.
    </div>

    <div class="section-title">ğŸ“ˆ Meteogram Meteociel</div>
    <div class="grid">
        <div>
            <button class="btn btn-secondary btn-small" onclick="toggleMeteogram()">ğŸ‘ï¸ Toggle</button>
            <button class="btn btn-primary btn-small" onclick="openMeteogramAnalyzer()">ğŸ“Š Î‘Î½Î¬Î»Ï…ÏƒÎ·</button>
            <div id="meteogramBox">
                <iframe id="meteogramIframe" src="https://www.meteociel.fr/cartes_obs/gens_display.php?lat=38.0972&lon=23.7736&ext=1&run=0&type=0" title="Meteociel"></iframe>
            </div>
        </div>
        <div class="analysis-box">
            <div class="section-title">ğŸ§  Î£ÏÎ½Î¿ÏˆÎ· Ï€ÏÎ¿Î³Î½Ï‰ÏƒÏ„Î¹ÎºÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</div>
            <div id="analysisText" class="analysis-inner">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½...</div>
        </div>
    </div>

    <!-- ğŸ“Š SINGLE COMBO CHART -->
    <div class="combo-chart-section">
        <div class="section-title">ğŸ“Š Î£Ï…Î½Î´Ï…Î±ÏƒÏ„Î¹ÎºÏŒ: Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î± + Î’ÏÎ¿Ï‡Î® + Î†Î½ÎµÎ¼Î¿Ï‚ (15 Î·Î¼Î­ÏÎµÏ‚)</div>
        <canvas id="comboChart"></canvas>
        <div class="legend">
            <div class="legend-item">ğŸŒ¡ï¸ Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î± Max (Â°C)</div>
            <div class="legend-item">ğŸŒ§ï¸ Î’ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ· (mm)</div>
            <div class="legend-item">ğŸ’¨ Î†Î½ÎµÎ¼Î¿Ï‚ Max (km/h)</div>
        </div>
    </div>

    <!-- Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬ / Î—Î¼Î­ÏÎµÏ‚ Ï€ÏÎ¿ÏƒÎ¿Ï‡Î®Ï‚ -->
    <div class="section-title">ğŸ“… Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬ Î±Î½Î¬ Î·Î¼Î­ÏÎ±</div>
    <div id="daysGrid" class="days-grid"></div>

    <div class="section-title" style="margin-top:8px;">ğŸš¨ Î—Î¼Î­ÏÎµÏ‚ Ï€ÏÎ¿ÏƒÎ¿Ï‡Î®Ï‚</div>
    <div id="specialDaysBox" class="analysis-inner" style="margin-top:4px;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½...</div>

    <div class="section-title" style="margin-top:10px;">ğŸ“¤ ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ·</div>
    <div class="share-box">
        <button class="btn btn-primary" onclick="shareViber()">ğŸ“± Viber</button>
        <button class="btn btn-primary" onclick="shareFacebook()">ğŸ“˜ Facebook</button>
        <button class="btn btn-secondary" onclick="copySummary()">ğŸ“‹ Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®</button>
    </div>

    <div class="section-title" style="margin-top:10px;">âš ï¸ ÎˆÎ½Ï„Î¿Î½Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î± (~48 ÏÏÎµÏ‚)</div>
    <div id="dangerBox" class="analysis-inner" style="margin-top:4px;">Î”ÎµÎ½ Î­Ï‡Î¿Ï…Î½ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÏ„ÎµÎ¯...</div>

    <!-- ÎœÎ¹ÎºÏÎ® Î»Î¯ÏƒÏ„Î± ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹ÏÎ½ ÎµÏ€Î¹ÎºÎ¹Î½Î´Ï…Î½ÏŒÏ„Î·Ï„Î±Ï‚ -->
    <div class="small" style="margin-top:4px;">
        <b>Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚ ÎµÏ€Î¹ÎºÎ¹Î½Î´Ï…Î½ÏŒÏ„Î·Ï„Î±Ï‚:</b>
        <ul style="margin-top:4px;margin-left:16px;">
            <li>â›ˆï¸ ÎšÎ±Ï„Î±Î¹Î³Î¯Î´ÎµÏ‚ / Î­Î½Ï„Î¿Î½Î· Î²ÏÎ¿Ï‡Î® â€“ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ Ï€Î»Î·Î¼Î¼ÏÏÎ±Ï‚, ÎºÎµÏÎ±Ï…Î½ÏÎ½.</li>
            <li>ğŸŒ¨ï¸ Î§Î¹Î¿Î½Î¿Ï€Ï„ÏÏƒÎµÎ¹Ï‚ / Ï€Î±Î³ÎµÏ„ÏŒÏ‚ â€“ Î¿Î»Î¹ÏƒÎ¸Î·ÏÏŒÏ„Î·Ï„Î± Î´ÏÏŒÎ¼Ï‰Î½, Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÎ¼Î¿Î¯.</li>
            <li>ğŸ’¨ Î˜Ï…ÎµÎ»Î»ÏÎ´ÎµÎ¹Ï‚ Î¬Î½ÎµÎ¼Î¿Î¹ â€“ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ Î±Ï€ÏŒ Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Î´Î­Î½Ï„ÏÏ‰Î½ / Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½.</li>
            <li>ğŸ”¥ Î¥ÏˆÎ·Î»Î­Ï‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚ / ÎºÎ±ÏÏƒÏ‰Î½Î±Ï‚ â€“ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ Î¸ÎµÏÎ¼Î¹ÎºÎ®Ï‚ ÎºÎ±Ï„Î±Ï€ÏŒÎ½Î·ÏƒÎ·Ï‚.</li>
            <li>ğŸŒŠ Î Î»Î·Î¼Î¼ÏÏÎµÏ‚ â€“ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ ÏƒÎµ ÏÎ­Î¼Î±Ï„Î±, Ï…Ï€ÏŒÎ³ÎµÎ¹Î± ÎºÎ±Î¹ Ï‡Î±Î¼Î·Î»Î¬ ÏƒÎ·Î¼ÎµÎ¯Î±.</li>
        </ul>
        Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÎ­Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Î±Î½Î¬ Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î¿:
        <a href="https://civilprotection.gov.gr/odigies-prostasias" target="_blank" style="color:#00d4ff;">
            civilprotection.gov.gr/odigies-prostasias
        </a>
    </div>

    <div class="section-title" style="margin-top:10px;">â° Î ÏŒÏ„Îµ Ï‡Î±Î»Î¬ÎµÎ¹ Î¿ ÎºÎ±Î¹ÏÏŒÏ‚</div>
    <div id="timingBox" class="analysis-inner" style="margin-top:4px;">Î‘Î½Î¬Î»Ï…ÏƒÎ·...</div>

    <div class="small" style="margin-top:6px;">
        â— Î’Î¿Î·Î¸Î·Ï„Î¹ÎºÎ­Ï‚ ÎµÎ½Î´ÎµÎ¯Î¾ÎµÎ¹Ï‚. Î•Ï€Î¯ÏƒÎ·Î¼Î±: Î•ÎœÎ¥, Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±, 112.
    </div>

    <div class="footer">Î•Ï†Î±ÏÎ¼Î¿Î³Î® Î›ÎµÏ…Ï„Î­ÏÎ·Ï‚ Î§Î±ÏÎ±Î»Î¬Î¼Ï€Î¿Ï…Ï‚ V15</div>
</div>

<!-- ğŸ” Î Î±ÏÎ¬Î¸Ï…ÏÎ¿ Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚ meteogram -->
<div id="meteogramAnalyzer" style="
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 998;
">
    <div style="
        width: 95%;
        max-width: 750px;
        max-height: 90vh;
        background: #050a14;
        border-radius: 16px;
        padding: 14px;
        border: 1px solid #00d4ff;
        display: flex;
        flex-direction: column;
        gap: 8px;
    ">
        <div style="display:flex;align-items:center;justify-content:space-between;">
            <div style="font-weight:700;font-size:14px;">
                ğŸ“Š Î‘Î½Î¬Î»Ï…ÏƒÎ· Meteogram â€“ <span id="meteogramAreaName">-</span>
            </div>
            <button onclick="closeMeteogramAnalyzer()" style="border:none;background:none;color:#fff;font-size:18px;cursor:pointer;">âœ–</button>
        </div>
        <div style="font-size:11px;opacity:0.8;">
            Meteogram Î±Ï€ÏŒ Meteociel Î³Î¹Î± Ï„Î·Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® + Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ® ÎµÏÎ¼Î·Î½ÎµÎ¯Î± (Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±, Î²ÏÎ¿Ï‡Î®, Î¬Î½ÎµÎ¼Î¿Ï‚, Î±Î­ÏÎ¹Î± Î¼Î¬Î¶Î± 850 hPa, ÎµÏ€Î¹ÎºÎ¹Î½Î´Ï…Î½ÏŒÏ„Î·Ï„Î±).
        </div>

        <iframe id="meteogramIframeBig"
                style="flex:1;min-height:260px;border-radius:10px;border:none;background:#000;"></iframe>

        <div style="display:flex;align-items:center;gap:6px;font-size:12px;">
            Î¤Î¹ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Î±Î½Î±Î»Ï…Î¸ÎµÎ¯;
            <select id="meteogramVarSelect" onchange="updateMeteogramAnalysis()" style="flex:1;padding:4px;border-radius:8px;border:none;">
                <option value="temp">Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±</option>
                <option value="rain">Î’ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ·</option>
                <option value="wind">Î†Î½ÎµÎ¼Î¿Ï‚</option>
                <option value="overall">Î“ÎµÎ½Î¹ÎºÎ® ÎµÎ¹ÎºÏŒÎ½Î± / 850 hPa</option>
            </select>
        </div>

        <div id="meteogramAnalysis" style="
            font-size:12px;
            background:#02040b;
            border-radius:10px;
            padding:8px;
            border-left:3px solid #00d4ff;
            white-space:pre-wrap;
            max-height:220px;
            overflow-y:auto;
        ">Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î±Î½Î¬Î»Ï…ÏƒÎ·Ï‚...</div>
    </div>
</div>

<!-- ğŸ’¬ ÎœÎ¹ÎºÏÏŒ chat widget -->
<div id="chatbox" style="
    position: fixed;
    right: 14px;
    bottom: 64px;
    width: 280px;
    height: 360px;
    background: #0a0f1a;
    border: 2px solid #00d4ff;
    border-radius: 14px;
    box-shadow: 0 0 18px #00d4ff44;
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 999;
">
    <div style="padding: 8px; background:#00d4ff; color:#000; font-weight:700; display:flex; justify-content:space-between; align-items:center;">
        <span>Live Chat</span>
        <button onclick="toggleChat()" style="border:none;background:transparent;font-size:18px;cursor:pointer;">âœ–</button>
    </div>
    <div id="chatLog" style="flex:1; padding:8px; overflow-y:auto; font-size:13px;"></div>
    <div style="display:flex;">
        <input id="chatInput" placeholder="Î“ÏÎ¬ÏˆÎµ..." style="flex:1; padding:6px; border:none;">
        <button onclick="sendChat()" style="padding:6px 10px; background:#00d4ff; border:none;">â¡</button>
    </div>
</div>

<button onclick="toggleChat()" style="
    position: fixed;
    bottom: 14px;
    right: 14px;
    background:#00d4ff;
    border:none;
    padding:12px 18px;
    border-radius:22px;
    font-weight:700;
    box-shadow:0 0 12px #00d4ff77;
    z-index:900;
">ğŸ’¬ Chat</button>

<script>
    // ğŸŒ GLOBAL VARS
    let forecastGlobal = null;
    let comboChartInstance = null;
    let currentLat = 38.0972, currentLon = 23.7736, currentName = 'Î©ÏÏ‰Ï€ÏŒÏ‚';
    let notificationEnabled = false;

    const AREAS = [
        { name: 'Î‘Î¸Î®Î½Î± â€“ ÎšÎ­Î½Ï„ÏÎ¿', lat: 37.9838, lon: 23.7275 },
        { name: 'Î‘Ï†Î¯Î´Î½ÎµÏ‚', lat: 38.212, lon: 23.83 },
        { name: 'Î†Î³Î¹Î¿Ï‚ Î£Ï„Î­Ï†Î±Î½Î¿Ï‚', lat: 38.145, lon: 23.855 },
        { name: 'Î”Î¹ÏŒÎ½Ï…ÏƒÎ¿Ï‚', lat: 38.095, lon: 23.87 },
        { name: 'Î•ÏÎ­Ï„ÏÎ¹Î± (Î•ÏÎ²Î¿Î¹Î±)', lat: 38.395, lon: 23.803 },
        { name: 'Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„ÎµÎ¹Î¿Ï‚ Î Î¿Î»Î¹Ï„ÎµÎ¯Î±', lat: 38.206, lon: 23.83 },
        { name: 'ÎšÎ±Î½Ï„ÏÎ¯Ï„Î¹ (ÎšÎ±Ï€Î±Î½Î´ÏÎ¯Ï„Î¹ Ï€ÎµÏÎ¯Ï€Î¿Ï…)', lat: 38.214, lon: 23.83 },
        { name: 'ÎšÎµÏÎ±Ï„ÏƒÎ¯Î½Î¹', lat: 37.963, lon: 23.619 },
        { name: 'ÎšÎ·Ï†Î¹ÏƒÎ¹Î¬', lat: 38.074, lon: 23.811 },
        { name: 'ÎšÏÏ…Î¿Î½Î­ÏÎ¹', lat: 38.143, lon: 23.822 },
        { name: 'ÎœÎ±Î»Î±ÎºÎ¬ÏƒÎ±', lat: 38.24, lon: 23.78 },
        { name: 'ÎœÎ±Î½Ï„Î¿ÏÎ´Î¹ (Î•ÏÎ²Î¿Î¹Î±)', lat: 38.79, lon: 23.35 },
        { name: 'ÎœÎ±ÏÎ¿ÏÏƒÎ¹', lat: 38.016, lon: 23.797 },
        { name: 'Î. ÎœÎ¬ÎºÏÎ·', lat: 38.086, lon: 23.98 },
        { name: 'ÎŸÎ¹Î½ÏŒÏ†Ï…Ï„Î±', lat: 38.3, lon: 23.65 },
        { name: 'Î©ÏÏ‰Ï€ÏŒÏ‚', lat: 38.0972, lon: 23.7736 },
        { name: 'Î ÎµÎ¹ÏÎ±Î¹Î¬Ï‚', lat: 37.942, lon: 23.646 },
        { name: 'Î¨Î±Ï‡Î½Î¬ (Î•ÏÎ²Î¿Î¹Î±)', lat: 38.58, lon: 23.65 },
        { name: 'Î¡Î±Ï†Î®Î½Î±', lat: 38.02, lon: 24.005 }
    ];

    // Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î±Î½Î¬ Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î¿
    const PHENOMENON_INFO = {
        storm: {
            icon: "â›ˆï¸",
            title: "Î™ÏƒÏ‡Ï…ÏÎ­Ï‚ ÎºÎ±Ï„Î±Î¹Î³Î¯Î´ÎµÏ‚ / Î­Î½Ï„Î¿Î½Î· Î²ÏÎ¿Ï‡Î®",
            tips: [
                "Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î¼ÎµÏ„Î±ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ ÏƒÎµ ÏÎ­Î¼Î±Ï„Î±, Ï‡ÎµÎ¹Î¼Î¬ÏÏÎ¿Ï…Ï‚ ÎºÎ±Î¹ Ï€Î»Î·Î¼Î¼Ï…ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ Î´ÏÏŒÎ¼Î¿Ï…Ï‚.",
                "ÎœÎ· Î´Î¹Î±ÏƒÏ‡Î¯Î¶ÎµÎ¹Ï‚ Î´ÏÏŒÎ¼Î¿Ï…Ï‚ Î¼Îµ Ï€Î¿Î»Î»Î¬ Î½ÎµÏÎ¬ Ï€ÎµÎ¶ÏŒÏ‚ Î® Î¼Îµ ÏŒÏ‡Î·Î¼Î±.",
                "Î‘Ï€ÏŒÏ†Ï…Î³Îµ ÎµÏÎ³Î±ÏƒÎ¯ÎµÏ‚ Ï…Ï€Î±Î¯Î¸ÏÎ¿Ï… ÎºÎ±Î¹ Ï€Î±ÏÎ±Î¼Î¿Î½Î® ÏƒÎµ Ï€Î±ÏÎ±Î»Î¯ÎµÏ‚ ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Î·Ï‚ ÎºÎ±Ï„Î±Î¹Î³Î¯Î´Î±Ï‚.",
                "Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÎµ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±ÏÎ±ÏƒÏ…ÏÎ¸Î¿ÏÎ½ Î±Ï€ÏŒ Ï„Î¿Î½ Î¬Î½ÎµÎ¼Î¿.",
                "Î‘ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎµ Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Ï„Ï‰Î½ Ï„Î¿Ï€Î¹ÎºÏÎ½ Î‘ÏÏ‡ÏÎ½ ÎºÎ±Î¹ Ï„Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± 112."
            ],
            link: "https://civilprotection.gov.gr/odigies-prostasias/kataigides"
        },
        snow: {
            icon: "ğŸŒ¨ï¸",
            title: "Î§Î¹Î¿Î½Î¿Ï€Ï„ÏÏƒÎµÎ¹Ï‚ / Ï€Î±Î³ÎµÏ„ÏŒÏ‚",
            tips: [
                "Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î¬ÏƒÎºÎ¿Ï€ÎµÏ‚ Î¼ÎµÏ„Î±ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ ÏƒÎµ Î¿ÏÎµÎ¹Î½Î­Ï‚ Î® Î·Î¼Î¹Î¿ÏÎµÎ¹Î½Î­Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚.",
                "Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Î±Î½Ï„Î¹Î¿Î»Î¹ÏƒÎ¸Î·Ï„Î¹ÎºÎ­Ï‚ Î±Î»Ï…ÏƒÎ¯Î´ÎµÏ‚ ÏŒÏ€Î¿Ï… Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹.",
                "ÎÏ„ÏÏƒÎ¿Ï… Î¼Îµ Ï€Î¿Î»Î»Î¬, Î¶ÎµÏƒÏ„Î¬ ÏÎ¿ÏÏ‡Î± ÎºÎ±Î¹ ÎºÎ¬Î»Ï…ÏˆÎµ ÎºÎµÏ†Î¬Î»Î¹ ÎºÎ±Î¹ Î¬ÎºÏÎ±.",
                "Î ÏÏŒÏƒÎµÏ‡Îµ Î³Î¹Î± Ï€Î¬Î³Î¿ ÏƒÎµ Ï€ÎµÎ¶Î¿Î´ÏÏŒÎ¼Î¹Î± ÎºÎ±Î¹ ÏƒÎºÎ¬Î»ÎµÏ‚.",
                "Î†ÎºÎ¿Ï… Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Ï„Î·Ï‚ Î¤ÏÎ¿Ï‡Î±Î¯Î±Ï‚ ÎºÎ±Î¹ Ï„Î·Ï‚ Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚."
            ],
            link: "https://civilprotection.gov.gr/odigies-prostasias/chionoptoseis-pagetos"
        },
        wind: {
            icon: "ğŸ’¨",
            title: "Î˜Ï…ÎµÎ»Î»ÏÎ´ÎµÎ¹Ï‚ Î¬Î½ÎµÎ¼Î¿Î¹",
            tips: [
                "Î‘ÏƒÏ†Î¬Î»Î¹ÏƒÎµ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± ÏƒÎµ Î¼Ï€Î±Î»ÎºÏŒÎ½Î¹Î± ÎºÎ±Î¹ Ï„Î±ÏÎ¬Ï„ÏƒÎµÏ‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±ÏÎ±ÏƒÏ…ÏÎ¸Î¿ÏÎ½.",
                "ÎœÎ· ÏƒÏ„Î­ÎºÎµÏƒÎ±Î¹ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Î¼ÎµÎ³Î¬Î»Î± Î´Î­Î½Ï„ÏÎ± Î® Ï€Î¹Î½Î±ÎºÎ¯Î´ÎµÏ‚.",
                "Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ ÏƒÎµ Î¸Î¬Î»Î±ÏƒÏƒÎ± ÎºÎ±Î¹ Ï€Î±ÏÎ¬ÎºÏ„Î¹ÎµÏ‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚.",
                "Î£Ï„Î¬Î¸Î¼ÎµÏ…ÏƒÎµ Ï„Î¿ ÏŒÏ‡Î·Î¼Î± Î¼Î±ÎºÏÎ¹Î¬ Î±Ï€ÏŒ Î´Î­Î½Ï„ÏÎ± ÎºÎ±Î¹ ÎºÎ¿Î»ÏÎ½ÎµÏ‚.",
                "Î‘ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎµ Ï„Î¹Ï‚ Î±Î½Î±ÎºÎ¿Î¹Î½ÏÏƒÎµÎ¹Ï‚ Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚."
            ],
            link: "https://civilprotection.gov.gr/odigies-prostasias/thyellodeis-anemoi"
        },
        heat: {
            icon: "ğŸ”¥",
            title: "Î¥ÏˆÎ·Î»Î­Ï‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚ / ÎºÎ±ÏÏƒÏ‰Î½Î±Ï‚",
            tips: [
                "ÎœÎµÎ¯Î½Îµ ÏƒÎµ Î´ÏÎ¿ÏƒÎµÏÎ¿ÏÏ‚, ÏƒÎºÎ¹ÎµÏÎ¿ÏÏ‚ ÎºÎ±Î¹ ÎºÎ»Î¹Î¼Î±Ï„Î¹Î¶ÏŒÎ¼ÎµÎ½Î¿Ï…Ï‚ Ï‡ÏÏÎ¿Ï…Ï‚.",
                "Î Î¯Î½Îµ Î¬Ï†Î¸Î¿Î½Î± Ï…Î³ÏÎ¬, Î±Ï€ÏŒÏ†Ï…Î³Îµ Î±Î»ÎºÎ¿ÏŒÎ» ÎºÎ±Î¹ Î²Î±ÏÎ¹Î¬ Î³ÎµÏÎ¼Î±Ï„Î±.",
                "Î‘Ï€ÏŒÏ†Ï…Î³Îµ Î²Î±ÏÎ¹Î¬ ÏƒÏ‰Î¼Î±Ï„Î¹ÎºÎ® ÎµÏÎ³Î±ÏƒÎ¯Î± ÎºÎ±Î¹ Î¬Î¸Î»Î·ÏƒÎ· Ï„Î¹Ï‚ Î¸ÎµÏÎ¼Î­Ï‚ ÏÏÎµÏ‚.",
                "Î¦ÏÏŒÎ½Ï„Î¹ÏƒÎµ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± Î²ÏÎ­Ï†Î·, Î·Î»Î¹ÎºÎ¹Ï‰Î¼Î­Î½Î¿Ï…Ï‚ ÎºÎ±Î¹ ÎµÏ…Ï€Î±Î¸ÎµÎ¯Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚.",
                "Î•Ï€Î¹ÎºÎ¿Î¹Î½ÏÎ½Î·ÏƒÎµ Î¼Îµ Î³Î¹Î±Ï„ÏÏŒ Î±Î½ ÎµÎ¼Ï†Î±Î½Î¯ÏƒÎµÎ¹Ï‚ ÏƒÏ…Î¼Ï€Ï„ÏÎ¼Î±Ï„Î± Î¸ÎµÏÎ¼Î¿Ï€Î»Î·Î¾Î¯Î±Ï‚."
            ],
            link: "https://civilprotection.gov.gr/odigies-prostasias/kaysonas"
        },
        flood: {
            icon: "ğŸŒŠ",
            title: "ÎšÎ¯Î½Î´Ï…Î½Î¿Ï‚ Ï€Î»Î·Î¼Î¼Ï…ÏÏÎ½",
            tips: [
                "ÎœÎ· Î´Î¹Î±ÏƒÏ‡Î¯Î¶ÎµÎ¹Ï‚ Ï€Î»Î·Î¼Î¼Ï…ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ Î´ÏÏŒÎ¼Î¿Ï…Ï‚ Î® Î¹ÏÎ»Î±Î½Î´Î¹ÎºÎ­Ï‚ Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹Ï‚.",
                "ÎœÎ· Î¼Î­Î½ÎµÎ¹Ï‚ ÏƒÎµ Ï…Ï€ÏŒÎ³ÎµÎ¹Î± Î® Î·Î¼Î¹Ï…Ï€ÏŒÎ³ÎµÎ¹Î± Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î»Î·Î¼Î¼Ï…ÏÎ¯ÏƒÎ¿Ï…Î½.",
                "ÎœÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎµ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± ÏƒÎµ ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î±Î½ ÎµÎ¯ÏƒÎ±Î¹ ÏƒÎµ ÎµÏ€Î¹ÎºÎ¯Î½Î´Ï…Î½Î· Î¶ÏÎ½Î·.",
                "ÎšÎ»ÎµÎ¯ÏƒÎµ ÏÎµÏÎ¼Î± ÎºÎ±Î¹ Î½ÎµÏÏŒ Î±Î½ ÏƒÎ¿Ï… Ï„Î¿ ÏƒÏ…ÏƒÏ„Î®ÏƒÎ¿Ï…Î½ Î¿Î¹ Î‘ÏÏ‡Î­Ï‚.",
                "Î†ÎºÎ¿Ï… Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÎ¬ Ï„Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± 112 ÎºÎ±Î¹ Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Ï„Ï‰Î½ Ï„Î¿Ï€Î¹ÎºÏÎ½ Ï†Î¿ÏÎ­Ï‰Î½."
            ],
            link: "https://civilprotection.gov.gr/odigies-prostasias/plimmyres"
        }
    };

    // Î‘ÏƒÏ†Î±Î»Î­Ï‚ fetch Î³Î¹Î± Android/WebView
    async function safeFetch(url) {
        try {
            return await fetch(url);
        } catch (e) {
            try {
                return await fetch(url, { mode: "cors" });
            } catch (e2) {
                throw e2;
            }
        }
    }

    // ğŸš¨ NOTIFICATIONS
    async function initNotifications() {
        if ('Notification' in window && Notification.permission === 'default') {
            const perm = await Notification.requestPermission();
            notificationEnabled = perm === 'granted';
        } else if ('Notification' in window && Notification.permission === 'granted') {
            notificationEnabled = true;
        }
    }

    function sendNotification(title, body) {
        if (notificationEnabled && 'Notification' in window && Notification.permission === 'granted') {
            new Notification(title, { body: body });
        }
    }

    // ğŸ“Š COMBO CHART
    function renderComboChart(data) {
        const ctx = document.getElementById('comboChart').getContext('2d');
        const days = data.daily.time.slice(0,15);
        const tmax = data.daily.temperature_2m_max.slice(0,15);
        const rain = data.daily.precipitation_sum?.slice(0,15) || Array(15).fill(0);
        const wind = data.daily.wind_speed_10m_max?.slice(0,15) || Array(15).fill(0);

        if (comboChartInstance) comboChartInstance.destroy();

        comboChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: days,
                datasets: [
                    {
                        label: 'Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î± Max (Â°C)',
                        data: tmax,
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0,212,255,0.1)',
                        yAxisID: 'y',
                        tension: 0.3,
                        fill: false
                    },
                    {
                        label: 'Î’ÏÎ¿Ï‡Î® (mm)',
                        data: rain,
                        borderColor: '#ff6b81',
                        backgroundColor: 'rgba(255,107,129,0.3)',
                        yAxisID: 'y1',
                        type: 'bar',
                        order: 1
                    },
                    {
                        label: 'Î†Î½ÎµÎ¼Î¿Ï‚ Max (km/h)',
                        data: wind,
                        borderColor: '#ffa502',
                        backgroundColor: 'rgba(255,165,2,0.15)',
                        yAxisID: 'y1',
                        tension: 0.3,
                        fill: false,
                        order: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        ticks: { 
                            autoSkip: true, 
                            maxTicksLimit: 10,
                            font: { size: 11 }
                        }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { 
                            display: true, 
                            text: 'Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î± (Â°C)',
                            font: { size: 12 }
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        grid: { drawOnChartArea: false },
                        title: { 
                            display: true, 
                            text: 'Î’ÏÎ¿Ï‡Î® (mm) / Î†Î½ÎµÎ¼Î¿Ï‚ (km/h)',
                            font: { size: 12 }
                        }
                    }
                },
                plugins: {
                    legend: { 
                        labels: { 
                            font: { size: 11 },
                            padding: 20
                        } 
                    },
                    tooltip: {
                        callbacks: {
                            label: ctx => {
                                const unit = ctx.datasetIndex === 0 ? 'Â°C' : 
                                           ctx.datasetIndex === 1 ? 'mm' : 'km/h';
                                return ` ${ctx.parsed.y} ${unit}`;
                            }
                        }
                    }
                }
            }
        });
    }

    function weatherEmojiAndName(code) {
        if ([0].includes(code)) return { emoji: "â˜€ï¸", name: "Î‘Î¯Î¸ÏÎ¹Î¿Ï‚" };
        if ([1,2,3].includes(code)) return { emoji: "ğŸŒ¤ï¸", name: "Î›Î¯Î³ÎµÏ‚ Î½ÎµÏ†ÏÏƒÎµÎ¹Ï‚" };
        if ([45,48].includes(code)) return { emoji: "ğŸŒ«ï¸", name: "ÎŸÎ¼Î¯Ï‡Î»Î·" };
        if ([51,53,55,61,63,65,80,81,82].includes(code)) return { emoji: "ğŸŒ§ï¸", name: "Î’ÏÎ¿Ï‡Î­Ï‚" };
        if ([71,73,75,85,86].includes(code)) return { emoji: "ğŸŒ¨ï¸", name: "Î§Î¹Î¿Î½Î¿Ï€Ï„ÏÏƒÎµÎ¹Ï‚" };
        if ([95,96,99].includes(code)) return { emoji: "â›ˆï¸", name: "ÎšÎ±Ï„Î±Î¹Î³Î¯Î´ÎµÏ‚" };
        return { emoji: "â”", name: "ÎšÎ±Î¹ÏÏŒÏ‚" };
    }

    function buildAnalysisText(data) {
        const d = data.daily;
        const todayMax = d.temperature_2m_max[0];
        const todayMin = d.temperature_2m_min[0];
        const todayRain = d.precipitation_sum[0];
        const todayWind = d.wind_speed_10m_max[0];
        const todayCode = d.weathercode[0];
        const w = weatherEmojiAndName(todayCode);

        const max15 = Math.max(...d.temperature_2m_max.slice(0,15));
        const min15 = Math.min(...d.temperature_2m_min.slice(0,15));

        let txt = "";
        txt += `Î ÎµÏÎ¹Î¿Ï‡Î®: ${currentName}\n`;
        txt += `Î£Î®Î¼ÎµÏÎ±: ${w.emoji} ${w.name}\n`;
        txt += `Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î±: Î±Ï€ÏŒ ${todayMin.toFixed(1)}Â°C Î­Ï‰Ï‚ ${todayMax.toFixed(1)}Â°C.\n`;
        txt += `Î’ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ·: ~${todayRain.toFixed(1)} mm / Î†Î½ÎµÎ¼Î¿Ï‚ Î­Ï‰Ï‚ ${todayWind.toFixed(0)} km/h.\n\n`;
        txt += `Î•Ï€ÏŒÎ¼ÎµÎ½ÎµÏ‚ 15 Î·Î¼Î­ÏÎµÏ‚:\n`;
        txt += `â€¢ ÎœÎ­Î³Î¹ÏƒÏ„Î· Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î± Ï†Ï„Î¬Î½ÎµÎ¹ Ï€ÎµÏÎ¯Ï€Î¿Ï… Î­Ï‰Ï‚ ${max15.toFixed(1)}Â°C.\n`;
        txt += `â€¢ Î•Î»Î¬Ï‡Î¹ÏƒÏ„Î· Î­Ï‰Ï‚ Ï€ÎµÏÎ¯Ï€Î¿Ï… ${min15.toFixed(1)}Â°C.\n`;

        const totalRain = d.precipitation_sum.slice(0,15).reduce((a,b)=>a+b,0);
        if (totalRain > 40) {
            txt += `â€¢ Î‘Ï…Î¾Î·Î¼Î­Î½Î· ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ® Î²ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ· (~${totalRain.toFixed(1)} mm), Ï€ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÎµ Ï€Î»Î·Î¼Î¼Ï…ÏÎ¹ÎºÎ¬ Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î±.\n`;
        } else if (totalRain > 10) {
            txt += `â€¢ Î ÎµÏÎ¯Î¿Î´Î¿Î¹ Î¼Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î²ÏÎ¿Ï‡Î­Ï‚ (~${totalRain.toFixed(1)} mm ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬).\n`;
        } else {
            txt += `â€¢ Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ Î²ÏÎ¿Ï‡Î­Ï‚ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬ (~${totalRain.toFixed(1)} mm).\n`;
        }

        txt += `\nÎŸÎ¹ ÎµÎ½Î´ÎµÎ¯Î¾ÎµÎ¹Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î´ÎµÎ¹ÎºÏ„Î¹ÎºÎ­Ï‚. Î“Î¹Î± ÎµÏ€Î¯ÏƒÎ·Î¼ÎµÏ‚ Ï€ÏÎ¿ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚: Î•ÎœÎ¥, Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±, 112.`;
        return txt;
    }

    function renderDaysGrid(data) {
        const grid = document.getElementById('daysGrid');
        const d = data.daily;
        grid.innerHTML = "";

        for (let i = 0; i < 15; i++) {
            const date = d.time[i];
            const max = d.temperature_2m_max[i];
            const min = d.temperature_2m_min[i];
            const rain = d.precipitation_sum[i];
            const wind = d.wind_speed_10m_max[i];
            const code = d.weathercode[i];
            const snow = d.snowfall_sum ? d.snowfall_sum[i] : 0;

            const w = weatherEmojiAndName(code);
            const sev = computeDaySeverity(max, rain, wind, snow);

            const sevLabel = ["Î§Î±Î¼Î·Î»Î®", "ÎœÎ­Ï„ÏÎ¹Î±", "Î¥ÏˆÎ·Î»Î®", "Î Î¿Î»Ï Ï…ÏˆÎ·Î»Î®"][sev];
            const sevColor = ["#2ed573", "#ffe66d", "#ffa502", "#ff4757"][sev];

            grid.innerHTML += `
                <div class="day-card" style="border-color: ${sevColor}33;">
                    <div class="day-header">
                        <div class="day-date">${date}</div>
                        <div class="day-emoji">${w.emoji}</div>
                    </div>
                    <div class="metric-row">Î˜: ${min.toFixed(1)}Â°C â€“ ${max.toFixed(1)}Â°C</div>
                    <div class="metric-row">Î’ÏÎ¿Ï‡Î®: ${rain.toFixed(1)} mm</div>
                    <div class="metric-row">Î†Î½ÎµÎ¼Î¿Ï‚: Î­Ï‰Ï‚ ${wind.toFixed(0)} km/h</div>
                    ${snow && snow > 0 ? `<div class="metric-row">Î§Î¹ÏŒÎ½Î¹: ${snow.toFixed(1)} cm</div>` : ""}
                    <div class="metric-row">Î•Ï€Î¹ÎºÎ¹Î½Î´Ï…Î½ÏŒÏ„Î·Ï„Î±: <b style="color:${sevColor}">${sevLabel}</b></div>
                </div>
            `;
        }
    }

    function computeDaySeverity(maxT, rain, wind, snow) {
        let level = 0;
        if (rain >= 20 || wind >= 65 || maxT >= 37 || snow >= 5) level = 2;
        if (rain >= 40 || wind >= 80 || maxT >= 40 || snow >= 15) level = 3;
        if ((rain >= 5 && rain < 20) || (wind >= 45 && wind < 65) || (maxT >= 32 && maxT < 37)) level = Math.max(level,1);
        return level;
    }

    function analyzeDangerousConditions(data) {
        const d = data.daily;
        const events = [];

        for (let i = 0; i < Math.min(4, d.time.length); i++) {
            const date = d.time[i];
            const maxT = d.temperature_2m_max[i];
            const rain = d.precipitation_sum[i];
            const wind = d.wind_speed_10m_max[i];
            const snow = d.snowfall_sum ? d.snowfall_sum[i] : 0;

            if (rain >= 20) {
                events.push({
                    type: rain >= 40 ? "flood" : "storm",
                    level: rain >= 40 ? 3 : 2,
                    date,
                    text: `Î Î¿Î»Ï Î²ÏÎ¿Ï‡ÎµÏÎ® Î·Î¼Î­ÏÎ± (${rain.toFixed(1)} mm). Î‘Ï…Î¾Î·Î¼Î­Î½Î¿Ï‚ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ Ï€Î»Î·Î¼Î¼Ï…ÏÏÎ½ ÏƒÎµ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚.`
                });
            }
            if (wind >= 65) {
                events.push({
                    type: "wind",
                    level: wind >= 80 ? 3 : 2,
                    date,
                    text: `Î˜Ï…ÎµÎ»Î»ÏÎ´ÎµÎ¹Ï‚ Î¬Î½ÎµÎ¼Î¿Î¹ Î­Ï‰Ï‚ ${wind.toFixed(0)} km/h. Î ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÎµ Î¼ÎµÏ„Î±ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± ÎºÎ±Î¹ Ï€Î±ÏÎ±Î¼Î¿Î½Î® ÎºÎ¿Î½Ï„Î¬ ÏƒÎµ Î´Î­Î½Ï„ÏÎ±.`
                });
            }
            if (snow >= 3) {
                events.push({
                    type: "snow",
                    level: snow >= 10 ? 3 : 2,
                    date,
                    text: `Î§Î¹Î¿Î½Î¿Ï€Ï„ÏÏƒÎµÎ¹Ï‚ (${snow.toFixed(1)} cm). Î Î¹Î¸Î±Î½Î® Î¿Î»Î¹ÏƒÎ¸Î·ÏÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¿Î¯ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÎ¼Î¿Î¯.`
                });
            }
            if (maxT >= 35) {
                events.push({
                    type: "heat",
                    level: maxT >= 38 ? 3 : 2,
                    date,
                    text: `Î¥ÏˆÎ·Î»Î­Ï‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚ Î¼Îµ Î¼Î­Î³Î¹ÏƒÏ„Î· Ï€ÎµÏÎ¯Ï€Î¿Ï… ${maxT.toFixed(1)}Â°C. Î ÏÎ¿ÏƒÎ¿Ï‡Î® ÏƒÎµ ÎµÏ…Ï€Î±Î¸ÎµÎ¯Ï‚ Î¿Î¼Î¬Î´ÎµÏ‚.`
                });
            }
        }

        return events;
    }

    function renderDangerBox(dangerEvents) {
        const box = document.getElementById('dangerBox');

        if (!dangerEvents || dangerEvents.length === 0) {
            box.textContent = "Î”ÎµÎ½ Î­Ï‡Î¿Ï…Î½ ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÏ„ÎµÎ¯ Î­Î½Ï„Î¿Î½Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î± ÏƒÏ„Î¹Ï‚ ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ ~48 ÏÏÎµÏ‚.";
            return;
        }

        let html = "";

        dangerEvents.forEach(ev => {
            const info = PHENOMENON_INFO[ev.type] || null;
            const sev = ev.level ?? 1;

            html += `
                <div style="margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.08);">
                    <div style="font-weight:700;font-size:13px;margin-bottom:2px;">
                        ${info ? info.icon : "âš ï¸"} 
                        ${info ? info.title : "ÎˆÎ½Ï„Î¿Î½Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î±"} 
                        â€“ Î•Ï€Î¯Ï€ÎµÎ´Î¿ ÎºÎ¹Î½Î´ÏÎ½Î¿Ï… ${sev}
                    </div>
                    ${ev.date ? `<div style="font-size:11px;opacity:0.85;margin-bottom:2px;">Î—Î¼Î­ÏÎ±: ${ev.date}</div>` : ""}
                    ${ev.text ? `<div style="font-size:11px;opacity:0.9;margin-bottom:4px;">${ev.text}</div>` : ""}
                    ${info ? `
                        <ul style="font-size:11px;margin:4px 0 4px 14px;padding:0;">
                            ${info.tips.map(t => `<li>${t}</li>`).join("")}
                        </ul>
                        <a href="${info.link}" target="_blank" style="font-size:11px;color:#00d4ff;text-decoration:none;">
                            â„¹ï¸ Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÎ­Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î¿
                        </a>
                    ` : ""}
                </div>
            `;
        });

        html += `
            <div style="font-size:10px;opacity:0.75;margin-top:4px;">
                ÎŸÎ¹ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÏƒÏ…Î¼Î²Î¿Ï…Î»Î­Ï‚ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ­Ï‚. Î“Î¹Î± Ï€Î»Î®ÏÎ· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯Ï„Îµ Ï€Î¬Î½Ï„Î±
                Ï„Î¹Ï‚ ÎµÏ€Î¯ÏƒÎ·Î¼ÎµÏ‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Ï„Î·Ï‚ Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ (civilprotection.gov.gr) ÎºÎ±Î¹ Ï„Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± 112.
            </div>
        `;

        box.innerHTML = html;
    }

    function renderTimingBox(dangerEvents) {
        const box = document.getElementById('timingBox');

        if (!dangerEvents || dangerEvents.length === 0) {
            box.textContent = "Î”ÎµÎ½ Ï€ÏÎ¿ÎºÏÏ€Ï„ÎµÎ¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ® ÎµÏ€Î¹Î´ÎµÎ¯Î½Ï‰ÏƒÎ· Î¼Î­ÏƒÎ± ÏƒÏ„Î¹Ï‚ ÎµÏ€ÏŒÎ¼ÎµÎ½ÎµÏ‚ 2â€“3 Î·Î¼Î­ÏÎµÏ‚ Î±Ï€ÏŒ Ï„Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±.";
            return;
        }

        dangerEvents.sort((a,b) => (a.date > b.date ? 1 : -1));
        const first = dangerEvents[0];
        const info = PHENOMENON_INFO[first.type] || null;

        box.textContent =
            `Î— ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Ï€Î¹Î¿ ÎºÏÎ¯ÏƒÎ¹Î¼Î· Ï†Î¬ÏƒÎ· Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Î³ÏÏÏ‰ ÏƒÏ„Î¹Ï‚ ${first.date}. ` +
            (info ? `${info.icon} ${info.title}. ` : "") +
            `Î ÏÎ¿Ï„ÎµÎ¯Î½ÎµÏ„Î±Î¹ Î­Î³ÎºÎ±Î¹ÏÎ· Ï€ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î± (Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Î±Ï€Î¿Ï‡ÎµÏ„ÎµÏÏƒÎµÏ‰Î½, Î±ÏƒÏ†Î¬Î»Î¹ÏƒÎ· Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½, Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· Î±Î½Î±ÎºÎ¿Î¹Î½ÏÏƒÎµÏ‰Î½ Î Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚).`;
    }

    function renderSpecialDaysBox(dangerEvents) {
        const box = document.getElementById('specialDaysBox');

        if (!dangerEvents || dangerEvents.length === 0) {
            box.textContent = "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎµÏ‚ Î·Î¼Î­ÏÎµÏ‚ Ï€ÏÎ¿ÏƒÎ¿Ï‡Î®Ï‚ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î± Ï„ÏÎ­Ï‡Î¿Î½Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±.";
            return;
        }

        let html = "Î—Î¼Î­ÏÎµÏ‚ Î¼Îµ Î±Ï…Î¾Î·Î¼Î­Î½Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½:\n\n";
        dangerEvents.forEach(ev => {
            const info = PHENOMENON_INFO[ev.type] || {};
            html += `â€¢ ${ev.date}: ${(info.icon || "âš ï¸")} ${(info.title || "ÎˆÎ½Ï„Î¿Î½Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î±")} â€“ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ ${ev.level}.\n`;
        });
        html += "\nÎŸÎ¹ ÎµÎºÏ„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿Î³Î½Ï‰ÏƒÏ„Î¹ÎºÎ­Ï‚ ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î»Î»Î¬Î¾Î¿Ï…Î½.";
        box.textContent = html;
    }

    async function loadForecastOropos() {
        const analysisEl = document.getElementById('analysisText');
        const lastUpdate = document.getElementById('lastUpdate');

        try {
            analysisEl.textContent = 'ğŸ“ Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ÏÎ¿Ï...';
            document.querySelector('h1').textContent = `ğŸŒ¦ï¸ 15Î®Î¼ÎµÏÎ· Î ÏÏŒÎ³Î½Ï‰ÏƒÎ· V15 â€“ ${currentName}`;

            const url = `https://api.open-meteo.com/v1/forecast?latitude=${currentLat}&longitude=${currentLon}&hourly=temperature_2m,precipitation_probability,precipitation,weathercode,wind_speed_10m&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max,snowfall_sum&forecast_days=16&current_weather=true&timezone=auto`;

            const res = await safeFetch(url);
            const data = await res.json();
            forecastGlobal = data;

            analysisEl.textContent = buildAnalysisText(data);
            renderComboChart(data);
            renderDaysGrid(data);

            const dangerEvents = analyzeDangerousConditions(data);
            renderDangerBox(dangerEvents);
            renderTimingBox(dangerEvents);
            updateStatusBarWithDanger(dangerEvents);
            renderSpecialDaysBox(dangerEvents);

            lastUpdate.textContent = new Date().toLocaleString('el-GR');

            if (dangerEvents.length > 0) {
                sendNotification(
                    "ğŸš¨ ÎšÎ±Î¹ÏÏŒÏ‚ â€“ Î ÏÎ¿ÏƒÎ¿Ï‡Î®",
                    `ÎˆÎ½Ï„Î¿Î½Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î± Î±Î½Î±Î¼Î­Î½Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ${currentName}. Î”ÎµÏ‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ ÏƒÏ„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÎºÎ±Î¹ ÏƒÏ„Î¿ civilprotection.gov.gr.`
                );
            }

        } catch (err) {
            console.error(err);
            analysisEl.textContent = 'âŒ Î ÏÏŒÎ²Î»Î·Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.';
            document.getElementById('statusBar').innerHTML = 'âš ï¸ Î”ÎµÎ½ ÎºÎ±Ï„Î­ÏƒÏ„Î· Î´Ï…Î½Î±Ï„Î® Î· Î±Î½Î¬Î»Ï…ÏƒÎ· ÎºÎ±Î¹ÏÎ¿Ï.';
        }
    }

    function toggleMeteogram() {
        const box = document.getElementById('meteogramBox');
        const iframe = document.getElementById('meteogramIframe');
        if (box.style.display === 'none') {
            box.style.display = '';
            iframe.src = `https://www.meteociel.fr/cartes_obs/gens_display.php?lat=${currentLat}&lon=${currentLon}&ext=1&run=0&type=0`;
        } else {
            box.style.display = 'none';
        }
    }

    function openMeteogramAnalyzer() {
        const modal = document.getElementById('meteogramAnalyzer');
        const areaLabel = document.getElementById('meteogramAreaName');
        const iframeBig = document.getElementById('meteogramIframeBig');

        areaLabel.textContent = currentName;
        iframeBig.src = `https://www.meteociel.fr/cartes_obs/gens_display.php?lat=${currentLat}&lon=${currentLon}&ext=1&run=0&type=0`;

        modal.style.display = 'flex';
        updateMeteogramAnalysis();
    }

    function closeMeteogramAnalyzer() {
        const modal = document.getElementById('meteogramAnalyzer');
        modal.style.display = 'none';
    }

    function updateMeteogramAnalysis() {
        const box = document.getElementById('meteogramAnalysis');
        const select = document.getElementById('meteogramVarSelect');
        const type = select.value;

        if (!forecastGlobal || !forecastGlobal.daily) {
            box.textContent = "Î”ÎµÎ½ Î­Ï‡Î¿Ï…Î½ Ï†Î¿ÏÏ„Ï‰Î¸ÎµÎ¯ Î±ÎºÏŒÎ¼Î· Ï„Î± Ï€ÏÎ¿Î³Î½Ï‰ÏƒÏ„Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ ÏƒÎµ Î»Î¯Î³Î± Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±.";
            return;
        }

        const d = forecastGlobal.daily;
        let text = "";

        // Î£Î¥Î“ÎšÎ•ÎšÎ¡Î™ÎœÎ•ÎÎ•Î£ Î‘ÎÎ‘Î›Î¥Î£Î•Î™Î£
        if (type === "temp") {
            const max15 = Math.max(...d.temperature_2m_max.slice(0,15));
            const min15 = Math.min(...d.temperature_2m_min.slice(0,15));
            let hottestIdx = 0;
            for (let i = 1; i < 15; i++) {
                if (d.temperature_2m_max[i] > d.temperature_2m_max[hottestIdx]) hottestIdx = i;
            }

            text += "Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯Î± (ÏƒÏ…Î½Î¿Ï€Ï„Î¹ÎºÎ® ÎµÎ¹ÎºÏŒÎ½Î± 15Î·Î¼Î­ÏÎ¿Ï…):\n\n";
            text += `â€¢ ÎŸÎ¹ Î¼Î­Î³Î¹ÏƒÏ„ÎµÏ‚ ÎºÏ…Î¼Î±Î¯Î½Î¿Î½Ï„Î±Î¹ Ï€ÎµÏÎ¯Ï€Î¿Ï… Î±Ï€ÏŒ ${min15.toFixed(1)}Â°C Î­Ï‰Ï‚ ${max15.toFixed(1)}Â°C.\n`;
            text += `â€¢ Î Î¹Î¿ Î¶ÎµÏƒÏ„Î® Î¼Î­ÏÎ±: Î³ÏÏÏ‰ ÏƒÏ„Î¹Ï‚ ${d.time[hottestIdx]} Î¼Îµ Î¼Î­Î³Î¹ÏƒÏ„Î· ~${d.temperature_2m_max[hottestIdx].toFixed(1)}Â°C.\n\n`;

            text += "Î ÏÏÏ„ÎµÏ‚ 5 Î·Î¼Î­ÏÎµÏ‚ (ÏŒÏ€Ï‰Ï‚ Ï†Î±Î¯Î½Î¿Î½Ï„Î±Î¹ ÎºÎ±Î¹ ÏƒÏ„Î¿ meteogram):\n";
            for (let i = 0; i < Math.min(5, d.time.length); i++) {
                const tmin = d.temperature_2m_min[i];
                const tmax = d.temperature_2m_max[i];
                let info = "";
                if (tmax >= 35) info = "Ï€Î¿Î»Ï Î¶Î­ÏƒÏ„Î· / Ï€Î¹Î¸Î±Î½ÏŒÏ‚ ÎºÎ±ÏÏƒÏ‰Î½Î±Ï‚";
                else if (tmax >= 30) info = "Î¸ÎµÏÎ¼Î® Î·Î¼Î­ÏÎ±";
                else if (tmax <= 5) info = "ÏˆÏ…Ï‡ÏÎ® Î·Î¼Î­ÏÎ±";
                else info = "Î®Ï€Î¹ÎµÏ‚ Î¸ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚";
                text += `â€¢ ${d.time[i]}: ${tmin.toFixed(1)}Â°C â€“ ${tmax.toFixed(1)}Â°C (${info}).\n`;
            }
        }

        if (type === "rain") {
            const rainArr = d.precipitation_sum.slice(0,15);
            const totalRain = rainArr.reduce((a,b)=>a+b,0);
            let maxIdx = 0;
            for (let i = 1; i < rainArr.length; i++) {
                if (rainArr[i] > rainArr[maxIdx]) maxIdx = i;
            }

            text += "Î’ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ· (ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ® ÎµÎ¹ÎºÏŒÎ½Î±):\n\n";
            text += `â€¢ Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î²ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ· 15Î·Î¼Î­ÏÎ¿Ï…: Ï€ÎµÏÎ¯Ï€Î¿Ï… ${totalRain.toFixed(1)} mm.\n`;
            text += `â€¢ Î Î¹Î¿ Î²ÏÎ¿Ï‡ÎµÏÎ® Î¼Î­ÏÎ±: ${d.time[maxIdx]} Î¼Îµ ~${rainArr[maxIdx].toFixed(1)} mm.\n\n`;

            text += "Î ÏÏÏ„ÎµÏ‚ 5 Î·Î¼Î­ÏÎµÏ‚:\n";
            for (let i = 0; i < Math.min(5, rainArr.length); i++) {
                let desc = "ÏƒÏ„ÎµÎ³Î½Î® Î® Î¼Îµ Î»Î¯Î³ÎµÏ‚ ÏƒÏ„Î±Î³ÏŒÎ½ÎµÏ‚";
                if (rainArr[i] >= 20) desc = "Î¹ÏƒÏ‡Ï…ÏÎ­Ï‚ Î²ÏÎ¿Ï‡Î­Ï‚ / Ï€Î¹Î¸Î±Î½Î­Ï‚ ÎºÎ±Ï„Î±Î¹Î³Î¯Î´ÎµÏ‚";
                else if (rainArr[i] >= 5) desc = "Î¼Î­Ï„ÏÎ¹ÎµÏ‚ Î²ÏÎ¿Ï‡Î­Ï‚";
                else if (rainArr[i] > 0) desc = "Î±ÏƒÎ¸ÎµÎ½ÎµÎ¯Ï‚ Î²ÏÎ¿Ï‡Î­Ï‚";
                text += `â€¢ ${d.time[i]}: ${rainArr[i].toFixed(1)} mm (${desc}).\n`;
            }
        }

        if (type === "wind") {
            const windArr = d.wind_speed_10m_max.slice(0,15);
            let maxIdx = 0;
            for (let i = 1; i < windArr.length; i++) {
                if (windArr[i] > windArr[maxIdx]) maxIdx = i;
            }
            const maxWind = windArr[maxIdx];

            text += "Î†Î½ÎµÎ¼Î¿Ï‚ (ÏÎ¹Ï€Î­Ï‚):\n\n";
            text += `â€¢ ÎœÎ­Î³Î¹ÏƒÏ„Î· Ï„Î¹Î¼Î® Î±Î½Î­Î¼Î¿Ï… ÏƒÏ„Î¿ 15Î®Î¼ÎµÏÎ¿: Ï€ÎµÏÎ¯Ï€Î¿Ï… ${maxWind.toFixed(0)} km/h ÏƒÏ„Î¹Ï‚ ${d.time[maxIdx]}.\n\n`;
            text += "Î ÏÏÏ„ÎµÏ‚ 5 Î·Î¼Î­ÏÎµÏ‚:\n";
            for (let i = 0; i < Math.min(5, windArr.length); i++) {
                let desc = "Î®Ï€Î¹Î¿Ï‚ Î­Ï‰Ï‚ Î¼Î­Ï„ÏÎ¹Î¿Ï‚";
                if (windArr[i] >= 80) desc = "Î¸Ï…ÎµÎ»Î»ÏÎ´ÎµÎ¹Ï‚ ÏÎ¹Ï€Î­Ï‚, Î±Ï…Î¾Î·Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÎ¿Ï‡Î®";
                else if (windArr[i] >= 60) desc = "Î¹ÏƒÏ‡Ï…ÏÎ¿Î¯ Î¬Î½ÎµÎ¼Î¿Î¹";
                else if (windArr[i] >= 40) desc = "ÎµÎ½Î¹ÏƒÏ‡Ï…Î¼Î­Î½Î¿Î¹ Î¬Î½ÎµÎ¼Î¿Î¹";
                text += `â€¢ ${d.time[i]}: Î­Ï‰Ï‚ ${windArr[i].toFixed(0)} km/h (${desc}).\n`;
            }
        }

        if (type === "overall") {
            const tmaxArr = d.temperature_2m_max.slice(0,15);
            const tminArr = d.temperature_2m_min.slice(0,15);
            const rainArr = d.precipitation_sum.slice(0,15);
            const windArr = d.wind_speed_10m_max.slice(0,15);

            const maxT = Math.max(...tmaxArr);
            const minT = Math.min(...tminArr);
            const totalRain = rainArr.reduce((a,b)=>a+b,0);
            const maxWind = Math.max(...windArr);

            text += "Î“ÎµÎ½Î¹ÎºÎ® ÎµÎ¹ÎºÏŒÎ½Î± ÎºÎ±Î¹ÏÎ¿Ï (Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ meteogram ÎºÎ±Î¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î¼Î¿Î½Ï„Î­Î»Î¿Ï…):\n\n";
            text += `â€¢ Î˜ÎµÏÎ¼Î¿ÎºÏÎ±ÏƒÎ¯ÎµÏ‚: Î±Ï€ÏŒ Ï€ÎµÏÎ¯Ï€Î¿Ï… ${minT.toFixed(1)}Â°C (Î¿Î¹ Ï€Î¹Î¿ ÎºÏÏÎµÏ‚ Ï„Î¹Î¼Î­Ï‚) Î­Ï‰Ï‚ ${maxT.toFixed(1)}Â°C (Î¿Î¹ Ï€Î¹Î¿ Î¶ÎµÏƒÏ„Î­Ï‚).\n`;
            text += `â€¢ Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î²ÏÎ¿Ï‡ÏŒÏ€Ï„Ï‰ÏƒÎ· 15Î·Î¼Î­ÏÎ¿Ï…: ~${totalRain.toFixed(1)} mm.\n`;
            text += `â€¢ ÎœÎ­Î³Î¹ÏƒÏ„Î¿Ï‚ Î¬Î½ÎµÎ¼Î¿Ï‚: Ï€ÎµÏÎ¯Ï€Î¿Ï… ${maxWind.toFixed(0)} km/h.\n\n`;

            // Î ÏÎ¿ÏƒÎ­Î³Î³Î¹ÏƒÎ· Î³Î¹Î± Î±Î­ÏÎ¹Î± Î¼Î¬Î¶Î± 850 hPa
            if (maxT >= 35) {
                text += "Î‘Î­ÏÎ¹Î± Î¼Î¬Î¶Î± ÏƒÏ„Î¿ 850 hPa: Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ Î¸ÎµÏÎ¼Î® Î¼Î¬Î¶Î±, Î¹Î´Î¯Ï‰Ï‚ ÏƒÏ„Î¹Ï‚ Î¸ÎµÏÎ¼Î­Ï‚ Î·Î¼Î­ÏÎµÏ‚ (Ï€Î¹Î¸Î±Î½Î­Ï‚ ÏƒÏ…Î½Î¸Î®ÎºÎµÏ‚ ÎºÎ±ÏÏƒÏ‰Î½Î± ÎºÎ¿Î½Ï„Î¬ ÏƒÏ„Î·Î½ ÎµÏ€Î¹Ï†Î¬Î½ÎµÎ¹Î±).\n";
            } else if (minT <= 2) {
                text += "Î‘Î­ÏÎ¹Î± Î¼Î¬Î¶Î± ÏƒÏ„Î¿ 850 hPa: Î±ÏÎºÎµÏ„Î¬ ÏˆÏ…Ï‡ÏÎ®, Î¹Î´Î¯Ï‰Ï‚ Ï„Î¹Ï‚ Ï€Î¹Î¿ ÎºÏÏÎµÏ‚ Î½ÏÏ‡Ï„ÎµÏ‚ â€“ Ï€Î¹Î¸Î±Î½ÏŒÏ„Î·Ï„Î± Î³Î¹Î± Ï€Î±Î³ÎµÏ„ÏŒ ÏƒÎµ Î¿ÏÎµÎ¹Î½Î¬/Î·Î¼Î¹Î¿ÏÎµÎ¹Î½Î¬.\n";
            } else {
                text += "Î‘Î­ÏÎ¹Î± Î¼Î¬Î¶Î± ÏƒÏ„Î¿ 850 hPa: Î¼Î­Ï„ÏÎ¹Î±, Ï„Ï…Ï€Î¹ÎºÎ® ÎµÏ€Î¿Ï‡Î¹ÎºÎ® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ Î±ÎºÏÎ±Î¯Î± ÏˆÏ…Ï‡ÏÎ­Ï‚ Î® Î¸ÎµÏÎ¼Î­Ï‚ ÎµÎ¹ÏƒÎ²Î¿Î»Î­Ï‚.\n";
            }

            // Î•ÎºÏ„Î¯Î¼Î·ÏƒÎ· ÎµÏ€Î¹ÎºÎ¹Î½Î´Ï…Î½ÏŒÏ„Î·Ï„Î±Ï‚
            const strongRain = rainArr.some(r => r >= 20);
            const veryStrongRain = rainArr.some(r => r >= 40);
            const strongWind = windArr.some(w => w >= 65);

            text += "\nÎ•ÎºÏ„Î¯Î¼Î·ÏƒÎ· ÎµÏ€Î¹ÎºÎ¹Î½Î´Ï…Î½ÏŒÏ„Î·Ï„Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿ Î´Î¹Î¬Î³ÏÎ±Î¼Î¼Î±:\n";
            if (veryStrongRain || strongWind || maxT >= 38) {
                text += "â€¢ Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ½Î´ÎµÎ¯Î¾ÎµÎ¹Ï‚ Î³Î¹Î± ÎµÏ€ÎµÎ¹ÏƒÏŒÎ´Î¹Î± Î¼Îµ Î­Î½Ï„Î¿Î½Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î± (Î´Ï…Î½Î±Ï„Î­Ï‚ Î²ÏÎ¿Ï‡Î­Ï‚/ÎºÎ±Ï„Î±Î¹Î³Î¯Î´ÎµÏ‚ Î® Ï€Î¿Î»Ï Î¹ÏƒÏ‡Ï…ÏÎ¿ÏÏ‚ Î±Î½Î­Î¼Î¿Ï…Ï‚ Î® Î­Î½Ï„Î¿Î½Î· Î¶Î­ÏƒÏ„Î·).\n";
            } else if (strongRain || maxWind >= 50) {
                text += "â€¢ ÎšÎ±Ï„Î¬ Ï€ÎµÏÎ¹ÏŒÎ´Î¿Ï…Ï‚ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Ï€Î¹Î¿ Â«Î³ÎµÎ¼Î¬Ï„ÎµÏ‚Â» ÎºÎ±ÎºÎ¿ÎºÎ±Î¹ÏÎ¯ÎµÏ‚, Î±Î»Î»Î¬ ÏŒÏ‡Î¹ ÏƒÎµ Î±ÎºÏÎ±Î¯Î± ÎµÏ€Î¯Ï€ÎµÎ´Î±.\n";
            } else {
                text += "â€¢ Î¤Î± Ï†Î±Î¹Î½ÏŒÎ¼ÎµÎ½Î± Ï†Î±Î¯Î½Î¿Î½Ï„Î±Î¹ Î³ÎµÎ½Î¹ÎºÎ¬ Î®Ï€Î¹Î± Î­Ï‰Ï‚ Î¼Î­Ï„ÏÎ¹Î±, Ï‡Ï‰ÏÎ¯Ï‚ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± ÎµÏ€Î¹ÎºÎ¯Î½Î´Ï…Î½ÎµÏ‚ ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚.\n";
            }

            text += "\nÎ£Ï…Î½Î¿Ï€Ï„Î¹ÎºÎ® Ï€ÏÏŒÎ³Î½Ï‰ÏƒÎ·:\n";
            if (maxT >= 35 && totalRain < 10) {
                text += "â€¢ ÎšÏ…ÏÎ¹Î±ÏÏ‡ÎµÎ¯ Î¶ÎµÏƒÏ„ÏŒ, ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¾Î·ÏÏŒ Î¼Î¿Ï„Î¯Î²Î¿ â€“ Ï€Î¹Î¿ Ï€Î¿Î»Ï Î¸Î­Î¼Î± Î¶Î­ÏƒÏ„Î·Ï‚ Ï€Î±ÏÎ¬ ÎºÎ±ÎºÎ¿ÎºÎ±Î¹ÏÎ¯Î±Ï‚.\n";
            } else if (totalRain > 40) {
                text += "â€¢ Î— Ï€ÎµÏÎ¯Î¿Î´Î¿Ï‚ Î­Ï‡ÎµÎ¹ Î±ÏÎºÎµÏ„Î­Ï‚ Î´Î¹Î±Ï„Î±ÏÎ±Ï‡Î­Ï‚ Î¼Îµ Î²ÏÎ¿Ï‡Î­Ï‚/ÎºÎ±Ï„Î±Î¹Î³Î¯Î´ÎµÏ‚. Î£Îµ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï€ÏÎ¿ÏƒÎ¿Ï‡Î® Î³Î¹Î± Ï„Î¿Ï€Î¹ÎºÎ­Ï‚ Ï€Î»Î·Î¼Î¼ÏÏÎµÏ‚.\n";
            } else if (maxWind >= 65) {
                text += "â€¢ ÎŸ Î¬Î½ÎµÎ¼Î¿Ï‚ Ï€Î±Î¯Î¶ÎµÎ¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ ÏÏŒÎ»Î¿, Î¼Îµ Î´Î¹Î±ÏƒÏ„Î®Î¼Î±Ï„Î± Î¸Ï…ÎµÎ»Î»Ï‰Î´ÏÎ½ ÏÎ¹Ï€ÏÎ½, Î¹Î´Î¯Ï‰Ï‚ ÏƒÎµ ÎµÎºÏ„ÎµÎ¸ÎµÎ¹Î¼Î­Î½ÎµÏ‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚.\n";
            } else {
                text += "â€¢ Î“ÎµÎ½Î¹ÎºÎ¬ ÎµÏ€Î¿Ï‡Î¹ÎºÏŒÏ‚ ÎºÎ±Î¹ÏÏŒÏ‚, Î¼Îµ ÎµÎ½Î±Î»Î»Î±Î³Î­Ï‚ Î·Î»Î¹Î¿Ï†Î¬Î½ÎµÎ¹Î±Ï‚/ÏƒÏ…Î½Î½ÎµÏ†Î¹Î¬Ï‚ ÎºÎ±Î¹ Ï„Î¿Ï€Î¹ÎºÎ­Ï‚ Î²ÏÎ¿Ï‡Î­Ï‚.\n";
            }
        }

        text += "\n\nÎ¤Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÎµÎ¯Î½Î±Î¹ Î²Î¿Î·Î¸Î·Ï„Î¹ÎºÏŒ ÎºÎ±Î¹ Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Î¯Î´Î¹Î¿ Ï€ÏÎ¿Î³Î½Ï‰ÏƒÏ„Î¹ÎºÏŒ Ï€Î±ÎºÎ­Ï„Î¿ Î¼Îµ Ï„Î¿ meteogram. Î“Î¹Î± ÎµÏ€Î¯ÏƒÎ·Î¼ÎµÏ‚ Ï€ÏÎ¿ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚: Î•ÎœÎ¥, Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±, 112.";
        box.textContent = text;
    }

    function shareViber() {
        alert("ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î¼Î¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï‚ Ï„Î¿ link Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î¼Î­ÏƒÏ‰ Viber.");
    }
    function shareFacebook() {
        alert("ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î¼Î¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï‚ Ï„Î¿ link Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î¼Î­ÏƒÏ‰ Facebook.");
    }
    function copySummary() {
        const txt = document.getElementById('analysisText').textContent;
        navigator.clipboard.writeText(txt).then(() => {
            alert("Î‘Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ Î· ÏƒÏÎ½Î¿ÏˆÎ· ÏƒÏ„Î¿ Ï€ÏÏŒÏ‡ÎµÎ¹ÏÎ¿.");
        }).catch(()=>{});
    }

    function toggleChat(){
        const box = document.getElementById('chatbox');
        box.style.display = box.style.display === 'flex' ? 'none' : 'flex';
    }
    function sendChat(){
        const input = document.getElementById('chatInput');
        const log = document.getElementById('chatLog');
        if (!input.value.trim()) return;
        log.innerHTML += `<div><b>Î•ÏƒÏ:</b> ${input.value}</div>`;
        log.scrollTop = log.scrollHeight;
        input.value = "";
    }

    function populateAreas() {
        const select = document.getElementById('areaSelect');
        select.innerHTML = "";
        AREAS.forEach((area, idx) => {
            const opt = document.createElement('option');
            opt.value = idx;
            opt.textContent = area.name;
            if (area.name === 'Î©ÏÏ‰Ï€ÏŒÏ‚') opt.selected = true;
            select.appendChild(opt);
        });

        select.addEventListener('change', () => {
            const idx = parseInt(select.value, 10);
            const area = AREAS[idx];
            currentLat = area.lat;
            currentLon = area.lon;
            currentName = area.name;
            loadForecastOropos();
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        populateAreas();
        initNotifications();
        loadForecastOropos();
    });
</script>
</body>
</html>
